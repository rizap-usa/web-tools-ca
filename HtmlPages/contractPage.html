<!-- Generated By dataTablesGen.xlsm -->
<div class='content container-fluid'>
  <!-- 標題 -->
  <div class='crms-title row bg-white'>
    <div class='col'>
      <h3 class='page-title m-0'>
        <span class='page-title-icon bg-gradient-primary text-white'>
          <i class='fa fa-check-square-o' aria-hidden='true'></i> <!--icon 視需要修改-->
        </span>
        <span id='ml-查詢合約狀態'>查詢合約狀態</span>
      </h3>
    </div>
  </div>
  <!-- 顯示/隱藏 欄位 選擇 Modal -->
  <div class='modal' id='contractSelHideColumn' tabindex='-1' role='dialog' aria-labelledby='ml-選擇顯示欄位' aria-hidden='true'>
    <div class='modal-dialog' role='document'>
      <div class='modal-content'>
        <div class='modal-header'>
          <h4 class='modal-title' id='ml-選擇顯示欄位'>Modal title</h4>
          <button type='button' class='close' data-dismiss='modal' aria-label='Close'>
            <span aria-hidden='true'>&times;</span>
          </button>
        </div>
              
        <div style='margin-top=10px'>
          <button type='button' class='btn btn-secondary' style='margin:10px;background:#4CC3D5;border:none' onclick='contractDispAll()'>
            <span id='ml-全部顯示'></span>
          </button>
          <button type='button' class='btn btn-secondary' style='margin:10px;background:#6D757D;border:none' onclick='contractHideAll()'>
            <span id='ml-全部隱藏'></span>
          </button>
        </div>
              
        <div class='modal-body' id='contract_modal'>
          <!--內容由下面程式 append-->
        </div>
              
        <div class='modal-footer'>
          <button type='button' class='btn btn-secondary' data-dismiss='modal'>
            <span id='ml-放棄設定'></span>
          </button>
          <button type='button' class='btn btn-primary' onclick='contractSetDispHide()'>
            <span id='ml-儲存設定'></span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div style='margin: 10px'>
    <span style='margin-left:0px' id ='ml-查詢年度'>查詢年度</span>
    <input id='contractQueryStartDate' style="width:50px"/>
<!--
    <span style='margin-left:30px' id ='ml-結束日期'>結束日期</span>
    <input id='contractQueryEndDate' type='date'/>
-->
        
    <button style='margin-left:30px' class='btn-gradient-primary font-weight-bold' onclick='contractCheck()' >
      <span id='ml-檢查'>檢 查</span>
    </button>
        
    <button type='button' style='float:right' class='btn-gradient-primary font-weight-bold' data-toggle='modal' data-target='#contractSelHideColumn'>
      <span id='ml-選擇顯示欄位'>選擇顯示欄位</span>
    </button>
        
    <button id='hidden_contract_Col' type='button' style='display:none; float:right;color:black;background:white; margin-right:10px' class='btn-gradient-primary font-weight-bold' >
      <span id='ml-有隱藏欄位'>有隱藏欄位</span>
    </button>
  </div>

  <div class='row'>
    <div class='col-md-12'>
      <div class='card mb-0'>
        <div class='card-body'>
          <div class='table-responsive'>
            <table id='contractDataTable' class='table table-striped table-nowrap custom-table mb-0'>
              <thead>
                <tr>
                  <th id='ml-店鋪名稱'>店鋪名稱</th>
                  <th id='ml-客戶名字'>店鋪名稱</th>
                  <th id='ml-客戶編號'>店鋪名稱</th>
                  <th id='ml-合約編號'>店鋪名稱</th>
                  <th id='ml-負責教練'>店鋪名稱</th>
                  <th id='ml-合約名稱'>店鋪名稱</th>
                  <th id='ml-合約簽訂日期'>店鋪名稱</th>
                  <th id='ml-合約總價_含稅'>店鋪名稱</th>
                  <th id='ml-合約總價_未稅'>店鋪名稱</th>
                  <th id='ml-合約狀態'>店鋪名稱</th>
                  <th id='ml-合約堂數'>店鋪名稱</th>
                  <th id='ml-合約已執行堂數'>店鋪名稱</th>
                  <th id='ml-合約剩餘堂數'>店鋪名稱</th>
                  <th id='ml-課程單價_含稅'>店鋪名稱</th>
                  <th id='ml-課程單價_未稅'>店鋪名稱</th>
                  <th id='ml-期初可用堂數'>店鋪名稱</th>
                  <th id='ml-上期認列金額_含稅'>店鋪名稱</th>
                  <th id='ml-上期認列金額_未稅'>店鋪名稱</th>
                  <th id='ml-上期未認列金額_含稅'>店鋪名稱</th>
                  <th id='ml-上期未認列金額_未稅'>店鋪名稱</th>
                  <th id='ml-今年_4已使用'>店鋪名稱</th>
                  <th id='ml-今年_5已使用'>店鋪名稱</th>
                  <th id='ml-今年_6已使用'>店鋪名稱</th>
                  <th id='ml-今年_7已使用'>店鋪名稱</th>
                  <th id='ml-今年_8已使用'>店鋪名稱</th>
                  <th id='ml-今年_9已使用'>店鋪名稱</th>
                  <th id='ml-今年_10已使用'>店鋪名稱</th>
                  <th id='ml-今年_11已使用'>店鋪名稱</th>
                  <th id='ml-今年_12已使用'>店鋪名稱</th>
                  <th id='ml-明年_1已使用'>店鋪名稱</th>
                  <th id='ml-明年_2已使用'>店鋪名稱</th>
                  <th id='ml-明年_3已使用'>店鋪名稱</th>
                  <th id='ml-今年_4已認列'>店鋪名稱</th>
                  <th id='ml-今年_5已認列'>店鋪名稱</th>
                  <th id='ml-今年_6已認列'>店鋪名稱</th>
                  <th id='ml-今年_7已認列'>店鋪名稱</th>
                  <th id='ml-今年_8已認列'>店鋪名稱</th>
                  <th id='ml-今年_9已認列'>店鋪名稱</th>
                  <th id='ml-今年_10已認列'>店鋪名稱</th>
                  <th id='ml-今年_11已認列'>店鋪名稱</th>
                  <th id='ml-今年_12已認列'>店鋪名稱</th>
                  <th id='ml-明年_1已認列'>店鋪名稱</th>
                  <th id='ml-明年_2已認列'>店鋪名稱</th>
                  <th id='ml-明年_3已認列'>店鋪名稱</th>
                  <th id='ml-合約已認列金額_含稅'>店鋪名稱</th>
                  <th id='ml-合約已認列金額_未稅'>店鋪名稱</th>
                  <th id='ml-合約未認列金額_含稅'>店鋪名稱</th>
                  <th id='ml-合約未認列金額_未稅'>店鋪名稱</th>
                  <th id='ml-顧客已付金額_含稅'>店鋪名稱</th>
                  <th id='ml-顧客已付金額_未稅'>店鋪名稱</th>
                  <th id='ml-顧客尚未付款_含稅'>店鋪名稱</th>
                  <th id='ml-顧客尚未付款_未稅'>店鋪名稱</th>
                  <th id='ml-取消堂數'>店鋪名稱</th>
                  <th id='ml-取消金額_含稅'>店鋪名稱</th>
                  <th id='ml-取消金額_未稅'>店鋪名稱</th>
                  <th id='ml-折讓堂數'>店鋪名稱</th>
                  <th id='ml-折讓金額_含稅'>店鋪名稱</th>
                  <th id='ml-折讓金額_未稅'>店鋪名稱</th>
                  <th id='ml-手續費'>店鋪名稱</th>
                  <th id='ml-折讓稅額'>店鋪名稱</th>
                  <th id='ml-付款日'>店鋪名稱</th>
                  <th id='ml-付款方式'>店鋪名稱</th>
                  <th id='ml-付款金額_含稅'>店鋪名稱</th>
                  <th id='ml-付款金額_未稅'>店鋪名稱</th>
                  <th id='ml-發票種類'>店鋪名稱</th>
                  <th id='ml-發票發行日期'>店鋪名稱</th>
                  <th id='ml-發票號碼'>店鋪名稱</th>
                  <th id='ml-備註說明'>店鋪名稱</th>
                </tr>
              </thead>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    function contractSetDispHide(){
      var someColIsHidden = false;
      for (var i=0;i<contractCol_nums;i++){
        var col_check_id = '#contractCol_' + i.toString();
        contractDataTable.column(i).visible(($(col_check_id).prop('checked')));
        if (!($(col_check_id).prop('checked'))) someColIsHidden = true;
      }
      (someColIsHidden)? $('#hidden_contract_Col').show():$('#hidden_contract_Col').hide();
      $('#contractSelHideColumn').modal('toggle');
    }

    function contractDispAll(){
      for (var i=0;i<contractCol_nums;i++){
        var col_check_id = '#contractCol_' + i.toString();
        $(col_check_id).prop('checked', true);
      }
    }

    function contractHideAll(){
      for (var i=0;i<contractCol_nums;i++){
        var col_check_id = '#contractCol_' + i.toString();
        $(col_check_id).prop('checked', false);
      }
    }

    $('#contractQueryStartDate').val(today.toISOString().substr(0,4));
    $('#contractQueryEndDate').val(today.toISOString().substr(0,10));  
    
    var contractDataTable =$('#contractDataTable').DataTable( {
      dom: 'Bfrtip',
      buttons: [
        { 'extend': 'csv', 'text':'<span id="ml-匯出CSV">匯出 CSV</span>','className': 'btn-gradient-primary font-weight-bold' },
        { 'extend': 'excel', 'text':'<span id="ml-匯出EXCEL">匯出 EXCEL</span>','className': 'btn-gradient-primary font-weight-bold' }
      ], 
      order: [[ 67, 'asc' ]],
      data: contractResult,  
      columnDefs: [
        { // 小數點下兩位
          targets: [7,8,13,14,16,17,18,19,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,56,57,58,59,62,63,],
          render: $.fn.dataTable.render.number(',', '.', 2)
        },
        { // 靠右對齊
          targets: [7,8,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,62,63,],
          className: 'number-to-right'
        },
      ] 
    } );
    // 處理 顯示/隱藏 的 modal 裡的項目
    var contractCol_nums = contractDataTable.columns()[0].length;
    for (var i=0; i< contractCol_nums; i+=2 ){
      var name_0= contractDataTable.column(i).header().outerHTML.split('\"')[1]; 
      if ((i+1) < contractCol_nums) var name_1 = contractDataTable.column(i+1).header().outerHTML.split('\"')[1];
      var appendHTML=
      `<div class='row'>
          <div class='col'>
            <input id='contractCol_${i}' type='checkbox' checked=true /> 
            <span id='${name_0}'></span>
          </div>
      `;
      appendHTML+= ((i+1) >= contractCol_nums)?'':
      `   <div class='col'>
            <input id='contractCol_${i+1}' type='checkbox' checked=true /> 
            <span id='${name_1}'></span>
          </div>
      `;
        
      $('#contract_modal').append(appendHTML);
    }
        
    $('#hidden_contract_Col').hide();
        
    if (localStorage.getItem('lang')!=null) setLang(localStorage.getItem('lang'));
    
    $('#contractDataTable').width('100%');
  </script>
</div>
